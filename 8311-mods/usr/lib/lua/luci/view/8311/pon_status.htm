<%#
  pon_status.htm -- PON Status display page

  Tabbed view showing live GPON/OMCI status information.  Tab content
  is fetched asynchronously by switchTabPonStatus() in 8311.js and
  rendered into the shared <textarea> element.

  Context variables (set by controller/8311.lua):
    pages : ordered table of { id, label, display } -- tab definitions
            display=false hides tabs that aren't relevant to the current
            ONU state (e.g. OMCI tabs hidden when not in O5)

  Tabs typically include: gtop_status, omci_info, vlan_data, etc.
  Default active tab: gtop_status (GPON GTC/ONU PLOAM state).
%>
<%

local tools = require "8311.tools"
local esc = tools.html_escape
-%>

<%+header%>
<script type="text/javascript" src="<%=resource%>/jquery-3.7.1.min.js"></script>
<script type="text/javascript" src="<%=resource%>/view/8311.js"></script>

<h2 name="content"><%:PON Status%></h2>
<br />

<div class="cbi-section">
	<h3><%:System Info%></h3>
	<textarea id="system_info" style="font-size:10pt; font-family: monospace;" readonly="readonly" wrap="off" rows="22">Loading...</textarea>
</div>

<div class="cbi-section">
	<h3><%:Diagnostic Pages%></h3>
	<ul class="cbi-tabmenu">
	<% for pageid, page in pairs(pages) do %>
		<li data-tab="<%= page.id %>" class="<% if pageid < 2 then %>cbi-tab<% else %>cbi-tab-disabled<% end %>"
	<%- if page.display == false then %> style="display: none"<% end %>>
		<a href="#" onclick="switchTabPonStatus('<%= page.id %>');"><%= esc(page.label) %></a></li>
	<% end %>
	</ul>
	<div class="content_syslog">
	<textarea id="syslog" style="font-size:10pt; font-family: monospace;" readonly="readonly" wrap="off" rows="48">
	</textarea>
	</div>
</div>

<script type="text/javascript">
$( document ).ready(function() {
	$.ajax({
		url: 'pontop/system_info',
		dataType: 'text'
	}).done(function(data) {
		$('#system_info').text(data);
	});
	switchTabPonStatus('gtop_status');
});
</script>

<%+footer%>
